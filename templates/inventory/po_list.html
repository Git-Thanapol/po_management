{% extends 'base.html' %} {% load humanize %} {% block title %}PO Management -
JST System{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2 class="mb-3">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <!-- Filters -->
    <div class="card p-3 shadow-sm mb-3">
      <h5 class="card-title text-primary">
        <i class="bi bi-search"></i> ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      </h5>
      <form method="get" class="row g-3">
        <div class="col-md-2">
          <label class="form-label">‡πÄ‡∏•‡∏Ç PO</label>
          <input
            type="text"
            name="po_number"
            class="form-control"
            value="{{ po_number_query }}"
            placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç PO..."
          />
        </div>
        <div class="col-md-2">
          <label class="form-label">SKU / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <input
            type="text"
            name="search"
            class="form-control"
            value="{{ search_query }}"
            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
          />
        </div>
        <div class="col-md-2">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select name="status" class="form-select">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option
              value="Pending"
              {%
              if
              status_filter=""
              ="Pending"
              %}selected{%
              endif
              %}
            >
              Pending
            </option>
            <option
              value="Complete"
              {%
              if
              status_filter=""
              ="Complete"
              %}selected{%
              endif
              %}
            >
              Complete
            </option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <select name="category" class="form-select">
            <option value="" {% if not selected_category %}selected{% endif %}>
              ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </option>
            {% for cat in categories %} {% if cat %}
            <option
              value="{{ cat }}"
              {%
              if
              cat=""
              ="selected_category"
              %}selected{%
              endif
              %}
            >
              {{ cat }}
            </option>
            {% endif %} {% endfor %}
          </select>
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
      </form>
    </div>

    <!-- Actions -->
    <div class="d-flex justify-content-start mb-3 gap-2">
      <a href="{% url 'po_create' %}" class="btn btn-success">
        <i class="bi bi-plus-lg"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á PO ‡πÉ‡∏´‡∏°‡πà (Create PO)
      </a>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table
            class="table table-hover table-striped align-middle mb-0"
            style="font-size: 0.9rem"
          >
            <thead class="text-nowrap text-center text-white">
              <tr>
                <th class="bg-dark">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
                <th class="bg-primary">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th class="bg-dark">‡∏£‡∏π‡∏õ</th>
                <th class="bg-dark">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="bg-dark">‡πÄ‡∏•‡∏Ç PO</th>
                <th class="bg-dark">‡∏Ç‡∏ô‡∏™‡πà‡∏á</th>

                <!-- Dates - Purple -->
                <th style="background-color: #6f42c1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                <th style="background-color: #6f42c1">‡∏ß‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</th>
                <th style="background-color: #6f42c1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th>
                <th style="background-color: #6f42c1">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>

                <!-- Received - Purple/Dark -->
                <th style="background-color: #6f42c1">‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</th>

                <!-- Ordered/Cost - Green -->
                <th style="background-color: #198754">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                <th style="background-color: #198754">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏ä‡∏¥‡πâ‡∏ô (‡∏ø)</th>

                <th class="bg-dark">‡∏¢‡∏≠‡∏î‡∏´‡∏¢‡∏ß‡∏ô (¬•)</th>
                <th class="bg-dark">‡∏¢‡∏≠‡∏î‡∏ö‡∏≤‡∏ó‡∏£‡∏ß‡∏° (‡∏ø)</th>
                <th class="bg-dark">‡πÄ‡∏£‡∏ó‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th class="bg-dark">‡πÄ‡∏£‡∏ó‡∏Ç‡∏ô‡∏™‡πà‡∏á</th>
                <th class="bg-dark">‡∏Ñ‡∏¥‡∏ß (CBM)</th>
                <th class="bg-dark">‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏£‡∏ß‡∏°</th>
                <th class="bg-dark">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (KG)</th>
                <th class="bg-dark">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ä‡∏¥‡πâ‡∏ô (¬•)</th>

                <!-- Platforms -->
                <th style="background-color: #fd7e14">SHOPEE</th>
                <th style="background-color: #0d6efd">LAZADA</th>
                <th class="bg-black">TIKTOK</th>

                <th class="bg-dark">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                <th class="bg-dark">attachfile</th>
              </tr>
            </thead>
            <tbody>
              {% for item in po_items %}
              <tr>
                <!-- Edit -->
                <td class="text-center">
                  <!-- Link to PO Detail or Edit -->
                  <a
                    href="{% url 'po_detail' item.header.id %}"
                    class="btn btn-sm btn-outline-warning border-0 p-0 text-warning"
                    title="Edit"
                  >
                    <i class="bi bi-pencil-square"></i>
                  </a>
                </td>

                <!-- SKU -->
                <td class="fw-bold text-primary">
                  {{ item.sku.product_code }}
                </td>

                <!-- Image -->
                <td class="text-center">
                  {% if item.sku.image %}
                  <img
                    src="{{ item.sku.image.url }}"
                    class="rounded"
                    style="height: 35px; width: 35px; object-fit: cover"
                  />
                  {% else %}
                  <span class="text-muted small">-</span>
                  {% endif %}
                </td>

                <!-- Status -->
                <td class="text-center">
                  {% if item.header.status == 'Pending' %}
                  <span class="badge rounded-pill bg-warning text-dark"
                    >‡∏£‡∏≠‡∏™‡πà‡∏á</span
                  >
                  {% elif item.header.status == 'Complete' %}
                  <span class="badge rounded-pill bg-success">‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
                  {% else %}
                  <span class="badge rounded-pill bg-secondary"
                    >{{ item.header.status }}</span
                  >
                  {% endif %}
                </td>

                <!-- PO No -->
                <td>
                  <a
                    href="{% url 'po_detail' item.header.id %}"
                    class="text-info text-decoration-none"
                  >
                    {{ item.header.po_number }}
                  </a>
                </td>

                <!-- Shipping -->
                <td class="text-center">
                  {{ item.header.get_shipping_type_display|default:"-" }}
                </td>

                <!-- Dates -->
                <td class="text-nowrap">
                  {{ item.header.order_date|date:"d/m/Y" }}
                </td>
                <td class="text-nowrap">
                  {{ item.header.estimated_date|date:"d/m/Y"|default:"-" }}
                </td>
                <td class="text-nowrap">-</td>
                <!-- Received Date Logic TBD -->

                <!-- Duration -->
                <td class="text-center">{{ item.duration_days }} ‡∏ß‡∏±‡∏ô</td>

                <!-- Qty -->
                <td class="text-center fw-bold text-success">
                  {{ item.total_received_qty }}
                </td>
                <td class="text-center fw-bold">{{ item.qty_ordered }}</td>

                <!-- Financials -->
                <td class="text-end text-primary fw-bold">
                  {{ item.unit_cost_baht|floatformat:2|intcomma }}
                </td>
                <td class="text-end">
                  {{ item.price_yuan|floatformat:2|intcomma }}
                </td>
                <td class="text-end">
                  {{ item.price_baht|floatformat:2|intcomma }}
                </td>

                <!-- Rates -->
                <td class="text-center">
                  {{ item.header.exchange_rate|floatformat:2 }}
                </td>
                <td class="text-center">
                  {% if item.header.shipping_rate_kg > 0 %} {{
                  item.header.shipping_rate_kg|floatformat:2 }} (KG) {% elif
                  item.header.shipping_rate_cbm > 0 %} {{
                  item.header.shipping_rate_cbm|floatformat:2 }} (CBM) {% else
                  %} - {% endif %}
                </td>

                <!-- Shipping Metrics -->
                <td class="text-end">
                  {{ item.cbm|floatformat:4|default:"-" }}
                </td>
                <td class="text-end">
                  {{ item.total_shipping_cost|floatformat:2|intcomma }}
                </td>
                <td class="text-end">
                  {{ item.weight|floatformat:2|default:"-" }}
                </td>

                <!-- Unit Price Yuan -->
                <td class="text-end">
                  {{ item.unit_price_yuan|floatformat:2 }}
                </td>

                <!-- Platforms -->
                <td class="text-end text-warning">
                  {{ item.sku.shopee_price|floatformat:2|default:"0.00" }}
                </td>
                <td class="text-end text-primary">
                  {{ item.sku.lazada_price|floatformat:2|default:"0.00" }}
                </td>
                <td class="text-end text-dark">
                  {{ item.sku.tiktok_price|floatformat:2|default:"0.00" }}
                </td>

                <!-- Note -->
                <td>
                  <small
                    class="d-block text-truncate"
                    style="max-width: 150px"
                    title="{{ item.header.note }}"
                  >
                    {{ item.header.note|default:"-" }}
                  </small>
                </td>

                <!-- Link -->
                <td class="text-center">
                  {% if item.header.link_shop %}
                  <a
                    href="{{ item.header.link_shop }}"
                    target="_blank"
                    class="text-info"
                    ><i class="bi bi-link-45deg fs-5"></i
                  ></a>
                  {% else %} - {% endif %}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="26" class="text-center py-5 text-muted">
                  <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                  ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (No PO Found)
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
