{% extends 'base.html' %} {% load humanize %} {% block title %}PO Management -
JST System{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2 class="mb-3">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

    <!-- Filters -->
    <div class="card p-3 shadow-sm mb-3">
      <h5 class="card-title text-primary">
        <i class="bi bi-search"></i> ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      </h5>
      <form method="get" class="row g-3">
        <div class="col-md-3">
          <label class="form-label">‡πÄ‡∏•‡∏Ç PO</label>
          <input
            type="text"
            name="po_number"
            class="form-control"
            value="{{ po_number_query }}"
            placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç PO..."
          />
        </div>
        <div class="col-md-3">
          <label class="form-label">SKU / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <input
            type="text"
            name="search"
            class="form-control"
            value="{{ search_query }}"
            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
          />
        </div>
        <div class="col-md-2">
          <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select name="status" class="form-select">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option
              value="Pending"
              {%
              if
              status_filter=""
              ="Pending"
              %}selected{%
              endif
              %}
            >
              Pending
            </option>
            <option
              value="Complete"
              {%
              if
              status_filter=""
              ="Complete"
              %}selected{%
              endif
              %}
            >
              Complete
            </option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <select name="category" class="form-select">
            <option value="" {% if not selected_category %}selected{% endif %}>
              ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </option>
            {% for cat in categories %} {% if cat %}
            <option
              value="{{ cat }}"
              {%
              if
              cat=""
              ="selected_category"
              %}selected{%
              endif
              %}
            >
              {{ cat }}
            </option>
            {% endif %} {% endfor %}
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
      </form>
    </div>

    <!-- Actions -->
    <div class="d-flex justify-content-end mb-3 gap-2">
      <a href="{% url 'po_create' %}" class="btn btn-success">
        <i class="bi bi-plus-lg"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á PO ‡πÉ‡∏´‡∏°‡πà (Create PO)
      </a>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table
            class="table table-hover table-striped align-middle mb-0"
            style="font-size: 0.9rem"
          >
            <thead class="table-dark text-nowrap">
              <tr>
                <th>Actions</th>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏£‡∏π‡∏õ</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (PO)</th>
                <th>‡πÄ‡∏•‡∏Ç PO</th>
                <th>‡∏Ç‡∏ô‡∏™‡πà‡∏á</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                <th>‡∏ß‡∏±‡∏ô‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</th>
                <th>‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß/‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                <th class="text-end">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (¬•)</th>
                <th class="text-end">‡∏¢‡∏≠‡∏î‡∏ö‡∏≤‡∏ó (‡∏ø)</th>
              </tr>
            </thead>
            <tbody>
              {% for item in po_items %}
              <tr>
                <td>
                  <!-- Edit Button: Navigates to Full PO Detail -->
                  <a
                    href="{% url 'po_detail' item.header.id %}"
                    class="btn btn-sm btn-outline-primary mb-1"
                  >
                    <i class="bi bi-pencil-square"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/Detail
                  </a>
                </td>
                <td class="fw-bold">
                  {{ item.sku.product_code }}<br /><small class="text-muted"
                    >{{ item.sku.name|truncatechars:20 }}</small
                  >
                </td>
                <td>
                  {% if item.sku.image %}
                  <img
                    src="{{ item.sku.image.url }}"
                    style="height: 35px; width: 35px; object-fit: cover"
                    class="rounded"
                  />
                  {% else %} - {% endif %}
                </td>
                <td>
                  {% if item.header.status == 'Pending' %}
                  <span class="badge bg-warning text-dark">‡∏£‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                  {% else %}
                  <span class="badge bg-success">‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
                  {% endif %}
                </td>
                <td>
                  <!-- Link Header to Detail -->
                  <a
                    href="{% url 'po_detail' item.header.id %}"
                    class="text-info text-decoration-none"
                  >
                    {{ item.header.po_number }}
                  </a>
                </td>
                <td>{{ item.header.shipping_type }}</td>
                <td>{{ item.header.order_date|date:"d/m/Y" }}</td>
                <td>{{ item.header.estimated_date|date:"d/m/Y" }}</td>
                <td>
                  <span
                    class="fw-bold {% if item.total_received_qty == item.qty_ordered %}text-success{% else %}text-warning{% endif %}"
                  >
                    {{ item.total_received_qty }}
                  </span>
                  / {{ item.qty_ordered }}
                </td>
                <td class="text-end">{{ item.price_yuan|intcomma }}</td>
                <td class="text-end fw-bold">{{ item.price_baht|intcomma }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="11" class="text-center py-4 text-muted">
                  ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
